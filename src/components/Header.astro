---
import { menuMain } from "~/data/menus";
import IconLogo from "~/assets/images/icons/logo.svg";
const rmTrailingSlash = (path: string): string => {
	return path.endsWith("/") && path.length > 1 ? path.slice(0, path.length - 1) : path;
};

const pathname = rmTrailingSlash(Astro.url.pathname);
---

<header>
	<section class="bg-yellow-200">
		<div class="container py-4 lg:py-8">
			<div class="flex justify-between items-center gap-x-4">
				<a href="/">
					<div class="flex items-center gap-x-2">
						<IconLogo class="h-5 lg:h-8 inline-block" />
						<span class="font-bold text-2xl lg:text-4xl">Hyper<span class="font-normal">Drive</span></span>
					</div>
				</a>

				<nav class="max-lg:hidden" role="navigation" aria-label="Main Navigation">
					<div class="flex lg:gap-x-12 items-center">
						{
							menuMain.map((item) => (
								<div class="relative group">
									<a
										href={item.url}
										class={`border-b-2 transition border-transparent ${pathname === item.url ? "font-bold" : "hover:border-gray-800 font-medium"}`}
										aria-haspopup={item.submenu ? "true" : "false"}
										aria-expanded={item.submenu ? "false" : undefined}
									>
										{item.label}
									</a>
									{item.submenu && (
										<div
											class="absolute top-full -mt-4 pt-4 -left-4 z-50 translate-y-4 w-screen max-w-52 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition duration-300"
											role="menu"
										>
											<div
												class="bg-white rounded-lg ring-1 shadow-md ring-gray-900/5 overflow-hidden"
												role="menu"
												aria-label={`Submenu for ${item.label}`}
											>
												{item.submenu.map((subItem) => (
													<a
														href={subItem.url}
														class={`block px-4 py-3 text-base hover:bg-gray-100 ${
															pathname === subItem.url ? "font-bold" : "font-medium"
														}`}
														role="menuitem"
													>
														{subItem.label}
													</a>
												))}
											</div>
										</div>
									)}
								</div>
							))
						}
						<!--<a href="/contact" class="button button-black ml-8">Contact</a>-->
					</div>
				</nav>

				<!-- Mobile controls group - RSS and Search on right -->
				<div class="mobile-controls">
					<a href="https://github.com/jdrhyne2/volks-typo" class="github-star-button" target="_blank" rel="noopener" title="Star on GitHub">
						<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
							<path d="M12 2C6.477 2 2 6.463 2 11.97c0 4.404 2.865 8.14 6.839 9.458.5.092.682-.216.682-.48 0-.236-.008-.864-.013-1.695-2.782.602-3.369-1.337-3.369-1.337-.454-1.151-1.11-1.458-1.11-1.458-.908-.618.069-.606.069-.606 1.003.07 1.531 1.027 1.531 1.027.892 1.524 2.341 1.084 2.91.828.092-.643.35-1.083.636-1.332-2.22-.251-4.555-1.107-4.555-4.927 0-1.088.39-1.979 1.029-2.675-.103-.252-.446-1.266.098-2.638 0 0 .84-.268 2.75 1.022A9.607 9.607 0 0112 6.82a9.55 9.55 0 012.504.336c1.909-1.29 2.747-1.022 2.747-1.022.546 1.372.202 2.386.1 2.638.64.696 1.028 1.587 1.028 2.675 0 3.83-2.339 4.673-4.566 4.92.359.307.678.915.678 1.846 0 1.332-.012 2.407-.012 2.734 0 .267.18.577.688.48 3.97-1.32 6.833-5.054 6.833-9.458C22 6.463 17.522 2 12 2z" fill="currentColor"/>
						</svg>
						<span class="github-star-text">Star</span>
					</a>

					<a href={base + "rss.xml"} class="rss-toggle" title="RSS Feed">
						<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
							<circle cx="5" cy="19" r="2" fill="currentColor"/>
							<path d="M3 3v2c8.284 0 15 6.716 15 15h2c0-9.389-7.611-17-17-17z" fill="currentColor"/>
							<path d="M3 9v2c4.963 0 9 4.037 9 9h2c0-6.065-4.935-11-11-11z" fill="currentColor"/>
						</svg>
						<span class="visually-hidden">RSS</span>
					</a>

					<button class="search-toggle" id="search-toggle" aria-label="Search articles">
						<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
							<circle cx="11" cy="11" r="8" stroke="currentColor" stroke-width="2" fill="none"/>
							<path d="M21 21l-4.35-4.35" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
						</svg>
					</button>
				</div>
			</div>
		</div>
	</section>
</header>

<style>
/* Desktop controls - visible by default */
.mobile-controls {
	--grid-unit: 8px;
	display: flex;
	align-items: center;
	gap: calc(var(--grid-unit) * 2);
}
/* Show mobile controls on right */
.mobile-controls {
	display: flex !important;
	gap: calc(var(--grid-unit) * 1.5);
}
@media (max-width: 480px) {
	/* Even smaller mobile adjustments */
	.mobile-controls {
		gap: calc(var(--grid-unit)) !important;
	}
}
</style>
